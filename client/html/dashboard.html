<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <link rel="stylesheet" href="../css/dashboard.css">
  <link rel="stylesheet" href="../css/modal.css">
  <link rel="stylesheet" href="../css/abrevieri.css">
  <link rel="stylesheet" href="../css/abrevieri-list.css">
  <link rel="stylesheet" href="../css/profil.css">
<link rel="stylesheet" href="../css/export.css">
  
  <!-- Guard pentru verificarea autentificării -->
  <script>
    (function() {
      function parseJwt(token) {
        try {
          const base64Url = token.split('.')[1];
          const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
          const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
          }).join(''));
          return JSON.parse(jsonPayload);
        } catch (e) {
          return null;
        }
      }
      
      function isValidToken(token) {
        if (!token) return false;
        
        try {
          const decoded = parseJwt(token);
          if (!decoded) return false;
          
          const currentTime = Date.now() / 1000;
          return !(decoded.exp && decoded.exp < currentTime);
        } catch (e) {
          return false;
        }
      }
      
      const token = localStorage.getItem('jwt');
      if (!isValidToken(token)) {
        window.location.href = 'login.html';
      }
    })();
  </script>
  
  <!-- Modulele JavaScript -->
  <script src="../js/auth-frontend.js"></script>
  <script src="../js/abrevieri-service.js"></script>
  <script src="../js/ui-handlers.js"></script>
  <script src="../js/dashboard.js" defer></script>
  <script src="../js/abrevieri-list.js" defer></script>
  <script src="../js/profil.js" defer></script>
<script src="../js/export.js" defer></script>

</head>
<body class="dashboard-body">
  <!-- Restul conținutului HTML rămâne neschimbat -->
  <div class="dashboard-container">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <h1>APlace</h1>
      </div>
      
      <nav class="nav-menu">
        <ul>
          <li class="nav-item">
            <a href="#" class="nav-link active" data-section="dashboard">
              <span class="nav-icon">📊</span>
              Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-section="add">
              <span class="nav-icon">➕</span>
              Add Abbreviation
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-section="list">
              <span class="nav-icon">📋</span>
              Abbreviation List
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-section="export">
              <span class="nav-icon">📤</span>
              Export
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-section="statistics">
              <span class="nav-icon">📈</span>
              Statistics
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-section="profile">
              <span class="nav-icon">👤</span>
              Profile
            </a>
          </li>
        </ul>
      </nav>
    </div>

    <!-- Conținut principal -->
    <div class="main-content">
      <!-- Header -->
      <div class="content-header">
        <div class="welcome-section">
          <h2 id="welcomeMessage">Bine ai venit!</h2>
          <p>Gestionează abrevierile tale cu ușurință</p>
        </div>
        <div id="auth-buttons" class="auth-buttons"></div>
      </div>

      <!-- Secțiunea Dashboard -->
      <div id="dashboard-section" class="content-section active">
        <!-- Carduri statistici -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-number" id="total-abbreviations">0</div>
            <div class="stat-label">Total Abrevieri</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="total-categories">0</div>
            <div class="stat-label">Categorii</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="coverage-percentage">0%</div>
            <div class="stat-label">Acoperire Abrevieri</div>
          </div>
        </div>

        <!-- Lista abrevierilor -->
        <div class="abbreviations-section">
          <h3>Abrevierile Tale</h3>
          <div class="abbreviations-container">
            <ul id="listaAbrevieri" class="abbreviations-list loading">
              Se încarcă abrevierile...
            </ul>
          </div>
        </div>

        <!-- Secțiunea de securitate -->
        <div class="security-section">
          <h3>Prezentare Generală Securitate</h3>
          <div class="security-icon-dashboard">
            <svg viewBox="0 0 24 24">
              <path d="M12,1A11,11 0 0,0 1,12A11,11 0 0,0 12,23A11,11 0 0,0 23,12A11,11 0 0,0 12,1M12,3A9,9 0 0,1 21,12A9,9 0 0,1 12,21A9,9 0 0,1 3,12A9,9 0 0,1 12,3M10,16.5L6,12.5L7.5,11L10,13.5L16.5,7L18,8.5L10,16.5Z" />
            </svg>
          </div>
          <p>Contul tău este protejat cu măsuri avansate de securitate.</p>
        </div>
      </div>

      <!-- Alte secțiuni -->
      <div id="add-section" class="content-section">
        <h3>Adaugă Abreviere Nouă</h3>
        <form id="addForm">
          <div>
            <label for="abreviere">Abreviere:</label>
            <input type="text" id="abreviere" required>
          </div>
          <div>
            <label for="semnificatie">Semnificație:</label>
            <input type="text" id="semnificatie" required>
          </div>
          <div>
            <label for="limba">Limbă:</label>
            <input type="text" id="limba" required>
          </div>
          <div>
            <label for="domeniu">Domeniu:</label>
            <input type="text" id="domeniu" required>
          </div>
          <button type="submit">Adaugă</button>
          <p id="addMesaj" class="mesaj"></p>
        </form>
      </div>

      <div id="list-section" class="content-section">
  <h3>Lista Abrevierilor</h3>
  <div class="filter-search-container">
    <div class="search-box">
      <input type="text" id="search-abrevieri" placeholder="Caută abreviere sau semnificație...">
      <button id="search-button"><span>🔍</span></button>
    </div>
    
    <div class="filters">
      <div class="filter-group">
        <label for="filter-limba">Limbă:</label>
        <select id="filter-limba">
          <option value="">Toate</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label for="filter-domeniu">Domeniu:</label>
        <select id="filter-domeniu">
          <option value="">Toate</option>
        </select>
      </div>
      
      <div class="filter-group" id="autor-filter-container">
        <label for="filter-autor">Autor:</label>
        <select id="filter-autor">
          <option value="">Toți</option>
        </select>
      </div>
      
      <button id="reset-filters" class="btn-reset">Resetează filtrele</button>
    </div>
  </div>
  
  <div class="abbreviations-container full-list">
    <div class="abbreviations-header">
      <div class="abrev-col">Abreviere</div>
      <div class="semnif-col">Semnificație</div>
      <div class="meta-col">Limba</div>
      <div class="meta-col">Domeniu</div>
      <div class="meta-col" id="autor-col">Autor</div>
      <div class="actions-col">Acțiuni</div>
    </div>
    
    <ul id="lista-completa-abrevieri" class="abbreviations-list loading">
      Se încarcă abrevierile...
    </ul>
    

    <div class="pagination-controls">
      <button id="prev-page" disabled>← Anterior</button>
      <span id="page-info">Pagina 1 din 1</span>
      <button id="next-page" disabled>Următor →</button>
    </div>
  </div>
  
  <div id="no-results" class="no-results hidden">
    <div class="empty-state">
      <div class="icon-container">
        <span>🔍</span>
      </div>
      <h4>Niciun rezultat găsit</h4>
      <p>Încercați alte criterii de căutare sau resetați filtrele.</p>
    </div>
  </div>
</div>

      <div id="export-section" class="content-section">
  <h3>Export Abrevieri</h3>
  
  <div class="export-container">
    <div class="export-option">
      <div class="export-info">
        <h4>📄 Export HTML</h4>
        <p>Descarcă abrevierile în format HTML cu lista de definiții (&lt;dt&gt;&lt;dd&gt;)</p>
      </div>
      <button id="export-html-btn" class="export-btn">
        Descarcă HTML
      </button>
    </div>
    
    <div class="export-option">
      <div class="export-info">
        <h4>📝 Export Markdown</h4>
        <p>Descarcă abrevierile în format Markdown pentru documentație</p>
      </div>
      <button id="export-markdown-btn" class="export-btn">
        Descarcă Markdown
      </button>
    </div>
    
    <div id="export-status" class="export-status hidden">
      <p id="export-message"></p>
    </div>
  </div>
</div>

      <div id="statistics-section" class="content-section">
        <div class="section-placeholder">
          <h3>Statistici Detaliate</h3>
          <p>Aici vor fi afișate grafice și statistici detaliate despre abrevieri.</p>
        </div>
      </div>

      <div id="profile-section" class="content-section">
  <div class="profile-card">
    <h3 class="section-title">Profilul Meu</h3>

    <div class="profile-container">
      <div class="avatar-box">
        <img id="profilePicturePreview" src="" alt="Avatar">
        <input type="file" id="profilePicture" accept="image/*" hidden>
        <button class="upload-btn">Încarcă Poză</button>
      </div>

      <div class="profile-info">
        <div class="profile-row">
          <label for="firstName">Prenume:</label>
          <input type="text" id="firstName">
        </div>
        <div class="profile-row">
          <label for="lastName">Nume:</label>
          <input type="text" id="lastName">
        </div>
        <div class="profile-row">
          <label for="email">Email:</label>
          <input type="email" id="email">
        </div>
        <div class="profile-row">
          <label for="phone">Telefon:</label>
          <input type="tel" id="phone">
        </div>
      </div>
    </div>

    <div class="about-card">
      <div class="about-header">
        <h4>Despre tine:</h4>
        <button id="editAboutBtn" class="edit-btn">Editează</button>
      </div>
      <textarea id="about" readonly></textarea>
    </div>

    <button id="saveProfileBtn" class="edit-btn" style="margin-top: 20px;">Salvează</button>
  </div>
</div>

    </div>
  </div>
</body>
</html>